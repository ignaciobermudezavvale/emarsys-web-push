<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>EmarsysWebPush</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script type="text/javascript" src="https://client-version.cf.emarsys.net/web-emarsys-sdk-v4/latest/web-emarsys-sdk.js" async></script>

  <script type="text/javascript">
    var ScarabQueue = ScarabQueue || [];
    (function(id) {
      if (document.getElementById(id)) return;
      var js = document.createElement('script'); js.id = id;
      js.src = '//cdn.scarabresearch.com/js/1C6A9FE107F1D289/scarab-v2.js';
      var fs = document.getElementsByTagName('script')[0];
      fs.parentNode.insertBefore(js, fs);
    })('scarab-js-api');
  </script>

  <script>
    // Identifying the visitor with email address. The email address is hashed before sending to Emarsys, as you can see in Live Event tool.
    
    
    // You can easily test how this works. Just replace the demo Merchant ID with your own.
    // Log in to the Emarsys Marketing Platform, go to Admin -> Data Sources, click Live Events, and on the events screen select ‚Äòmy visit‚Äô from the dropdown. 
    // Hit Run in JSFiddle. Refresh Live Events and you should see these event reported with the above values.
  </script>

  <script>
    localStorage.setItem('emarsys:debug', 'true');
  </script>
  <script type="text/javascript">

    ScarabQueue.push(['setEmail', 'tommy.oliver@method.com.ar']);

    ScarabQueue.push(['cart', [
      {item: '000011020180190140cannonSite', price: 75, quantity: 1},
    ]]);
    
    // This command is required for all JS API funcions. It closes and fires the ScarabQueue. Should be the last call on the page, called only once.
    ScarabQueue.push(['go']);


    window.WebEmarsysSdk = window.WebEmarsysSdk || [];
    WebEmarsysSdk.push(['init', {
      applicationCode: 'EMSDE-283A2', // your Domain code obtained above
      enableMacSafariVapid: false, // If true, enables VAPID instead of APNS for Safari on Mac
      defaultNotificationTitle: 'Web push Piero', // sets your default title for push notifications
      defaultNotificationIcon: 'https://yoursite.com/img/your-logo.png', // URL to your notification icon
      autoSubscribe: true, // If true, prompts a user to subscribe for pushes upon SDK initialization which is not recommended
      serviceWorker: {
        url: 'web-emarsys-service-worker.js',
        applicationServerPublicKey: 'BIHgJ07cJBGpQplKGGd-CdJWgNYwBqvWNg65fiPXpIUn9fZuNZ121tUMdmwpBkzPYtu9i17JmFD_eboYiS3KcSU'
      }
    }])
    console.log('WebEmarsysSdk execute');
    WebEmarsysSdk.push(['onError', (e) => console.error('Emarsys SDK error:', e)]);
    WebEmarsysSdk.push(['onSubscribe', () => console.log('‚úÖ Usuario suscripto a Web Push')]);
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const permission = await Notification.requestPermission();
        console.log('üü¢ Permiso de notificaciones:', permission);
        if (permission === 'granted') {
          WebEmarsysSdk.push(['subscribe']);
        } else {
          console.warn('‚ö†Ô∏è El usuario no otorg√≥ permisos de notificaci√≥n.');
        }
      } catch (err) {
        console.error('‚ùå Error al pedir permiso de notificaciones:', err);
      }
    });
  </script>
  <script>
    function generalSubscribe() {
            return WebEmarsysSdk.subscribe()
    }
    // The submit event fires when a <form> is submitted.
    document.addEventListener('submit', function(e) {
            generalSubscribe();
    });
    // An element receives a click event when a pointing device button (such as a mouse's primary mouse button) is both pressed and released while the pointer is located inside the element.
    document.addEventListener('click', function(e) {
            generalSubscribe();
    });
  </script>
</head>
<body>
  <button onclick="generalSubscribe()">Subscribe</button>
  <app-root></app-root>
</body>
</html>
